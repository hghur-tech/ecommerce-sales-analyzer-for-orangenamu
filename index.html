<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ì»¤ë¨¸ìŠ¤ ë§¤ì¶œë¶„ì„ ì‹œìŠ¤í…œ V5.2 - ì™„ì „ ë³µì›</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
         {
            .no-print { display: none !important; }
            body { margin: 0; padding: 20px; }
            .print-section { page-break-inside: avoid; margin-bottom: 20px; }
        }
        .chart-container { height: 400px; margin: 20px 0; }
        .file-input { 
            background: #3B82F6; 
            color: white; 
            padding: 10px 20px; 
            border-radius: 8px; 
            border: none; 
            cursor: pointer; 
            margin: 10px 0;
            display: inline-block;
        }
        .btn-primary { 
            background: #3B82F6; 
            color: white; 
            padding: 12px 24px; 
            border-radius: 8px; 
            border: none; 
            cursor: pointer; 
            margin: 10px 5px;
        }
        .btn-secondary { 
            background: #6B7280; 
            color: white; 
            padding: 12px 24px; 
            border-radius: 8px; 
            border: none; 
            cursor: pointer; 
            margin: 10px 5px;
        }
        .btn-success { 
            background: #10B981; 
            color: white; 
            padding: 12px 24px; 
            border-radius: 8px; 
            border: none; 
            cursor: pointer; 
            margin: 10px 5px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6 max-w-7xl">
        <!-- í—¤ë” -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-chart-line text-blue-500 mr-3"></i>
                ì´ì»¤ë¨¸ìŠ¤ ë§¤ì¶œë¶„ì„ ì‹œìŠ¤í…œ V5.2
            </h1>
            <p class="text-gray-600">ì™„ì „í•œ ë§¤ì¶œ ë¶„ì„, í”½í‚¹ë¦¬ìŠ¤íŠ¸ ìƒì„±, ERP ì—°ë™ ì¢…í•© ì‹œìŠ¤í…œ</p>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div id="uploadSection" class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4"><i class="fas fa-upload text-green-500 mr-2"></i>1ë‹¨ê³„: ë§¤ì¶œ Excel íŒŒì¼ ì—…ë¡œë“œ</h2>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                <i class="fas fa-file-excel text-4xl text-green-500 mb-4"></i>
                <p class="text-gray-600 mb-4">ë§¤ì¼ ë§¤ì¶œ Excel íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                <input type="file" id="salesFile" accept=".xlsx,.xls" class="file-input">
                <p id="mainFileName" class="text-sm text-gray-500 mt-2"></p>
            </div>
        </div>

        <!-- 3ì‹œ ì´í›„ íŒŒì¼ ì„ íƒ ì„¹ì…˜ -->
        <div id="additionalFileSection" class="bg-white rounded-lg shadow-md p-6 mb-6" style="display: none;">
            <h2 class="text-xl font-semibold mb-4"><i class="fas fa-clock text-orange-500 mr-2"></i>2ë‹¨ê³„: ì „ì¼ 3ì‹œ ì´í›„ ì¶œê³  ë°ì´í„°</h2>
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                <p class="text-gray-700 mb-4"><i class="fas fa-question-circle text-orange-500 mr-2"></i>ì „ì¼ 3ì‹œ ì´í›„ ì¶œê³  ë°ì´í„°ê°€ ìˆë‚˜ìš”?</p>
                <button id="hasAdditionalFile" class="btn-primary mr-4">
                    <i class="fas fa-check mr-2"></i>ë„¤, ì¶”ê°€ íŒŒì¼ì´ ìˆìŠµë‹ˆë‹¤
                </button>
                <button id="noAdditionalFile" class="btn-secondary">
                    <i class="fas fa-times mr-2"></i>ì•„ë‹ˆìš”, ë°”ë¡œ ë¶„ì„
                </button>
            </div>
            
            <div id="additionalFileUpload" style="display: none;" class="mt-4">
                <div class="border-2 border-dashed border-orange-300 rounded-lg p-6 text-center">
                    <i class="fas fa-file-plus text-3xl text-orange-500 mb-3"></i>
                    <p class="text-gray-600 mb-4">ì „ì¼ 3ì‹œ ì´í›„ ì¶œê³  Excel íŒŒì¼ ì—…ë¡œë“œ</p>
                    <input type="file" id="additionalFile" accept=".xlsx,.xls" class="file-input">
                    <p id="additionalFileName" class="text-sm text-blue-600 mt-2 font-medium"></p>
                </div>
                <button id="startAnalysis" class="btn-success mt-4" style="display: none;">
                    <i class="fas fa-play mr-2"></i>ë¶„ì„ ì‹œì‘
                </button>
            </div>
        </div>

        <!-- ê²°ê³¼ ì„¹ì…˜ë“¤ -->
        <div id="resultsContainer" style="display: none;">
            <!-- í”½í‚¹ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
            <div id="pickingSection" class="bg-white rounded-lg shadow-md p-6 mb-6 print-section">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold"><i class="fas fa-list-check text-purple-500 mr-2"></i>í”½í‚¹ëŒ€ìƒìš© íŒŒì¼ ë¦¬ìŠ¤íŠ¸</h2>
                    <button id="printPicking" class="btn-primary no-print">
                        <i class="fas fa-print mr-2"></i>ì¸ì‡„
                    </button>
                </div>
                <div id="pickingTable"></div>
            </div>

            <!-- TOP 20 SKU ë¶„ì„ -->
            <div id="top20Section" class="bg-white rounded-lg shadow-md p-6 mb-6 print-section">
                <h2 class="text-xl font-semibold mb-4"><i class="fas fa-trophy text-yellow-500 mr-2"></i>TOP 20 SKU ë¶„ì„</h2>
                <div class="chart-container">
                    <canvas id="top20Chart"></canvas>
                </div>
                <div id="top20Table"></div>
            </div>

            <!-- ë§ˆì¼“ë³„ TOP 10 ë¶„ì„ -->
            <div id="marketAnalysisSection" class="bg-white rounded-lg shadow-md p-6 mb-6 print-section">
                <h2 class="text-xl font-semibold mb-4"><i class="fas fa-store text-red-500 mr-2"></i>ë§ˆì¼“ë³„ TOP 10 ë¶„ì„</h2>
                <div id="marketCharts"></div>
                <div id="marketTables"></div>
            </div>

            <!-- ERP ì—°ë™ ë° ìë™í™” -->
            <div id="erpSection" class="bg-white rounded-lg shadow-md p-6 mb-6 print-section">
                <h2 class="text-xl font-semibold mb-4"><i class="fas fa-cogs text-indigo-500 mr-2"></i>ERP ì—°ë™ ë° ìë™í™”</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <button id="generateSalesDeduction" class="btn-primary p-6 text-left">
                        <i class="fas fa-file-download text-2xl mb-2"></i>
                        <div class="font-semibold">íŒë§¤ì°¨ê°ìš©íŒŒì¼ìƒì„±</div>
                        <div class="text-sm opacity-80">ì´ì¹´ìš´íŠ¸ ERP ì—°ë™ìš© íŒŒì¼</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let salesData = [];
        let additionalData = [];
        let processedData = [];

        // íŒŒì¼ ì—…ë¡œë“œ ì´ë²¤íŠ¸
        document.getElementById('salesFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('mainFileName').textContent = `ì„ íƒëœ íŒŒì¼: ${file.name}`;
                document.getElementById('additionalFileSection').style.display = 'block';
                readExcelFile(file, 'main');
            }
        });

        document.getElementById('additionalFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('additionalFileName').textContent = `ì„ íƒëœ íŒŒì¼: ${file.name}`;
                document.getElementById('startAnalysis').style.display = 'inline-block';
                readExcelFile(file, 'additional');
            }
        });

        // ì¶”ê°€ íŒŒì¼ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById('hasAdditionalFile').addEventListener('click', function() {
            document.getElementById('additionalFileUpload').style.display = 'block';
        });

        document.getElementById('noAdditionalFile').addEventListener('click', function() {
            startDataAnalysis();
        });

        document.getElementById('startAnalysis').addEventListener('click', function() {
            startDataAnalysis();
        });

        // Excel íŒŒì¼ ì½ê¸°
        function readExcelFile(file, type) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                if (type === 'main') {
                    salesData = processRawData(jsonData);
                } else {
                    additionalData = processRawData(jsonData);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // ì›ì‹œ ë°ì´í„° ì²˜ë¦¬
        function processRawData(jsonData) {
            if (jsonData.length < 2) return [];
            
            const headers = jsonData[0];
            const rows = jsonData.slice(1);
            
            return rows.map(row => {
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header] = row[index] || '';
                });
                return obj;
            }).filter(row => row['SKUì½”ë“œ'] || row['SKUìƒí’ˆëª…']);
        }

        // ë°ì´í„° ë¶„ì„ ì‹œì‘
        function startDataAnalysis() {
            // ë©”ì¸ ë°ì´í„°ì™€ ì¶”ê°€ ë°ì´í„° ë³‘í•©
            processedData = [...salesData, ...additionalData];
            
            document.getElementById('resultsContainer').style.display = 'block';
            
            // ê° ë¶„ì„ í•¨ìˆ˜ í˜¸ì¶œ
            generatePickingList();
            generateTop20Analysis();
            generateMarketAnalysis();
            
            // ìŠ¤í¬ë¡¤ì„ ê²°ê³¼ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
            document.getElementById('resultsContainer').scrollIntoView({ behavior: 'smooth' });
        }

        // í”½í‚¹ë¦¬ìŠ¤íŠ¸ ìƒì„±
        function generatePickingList() {
            const pickingData = [];
            
            processedData.forEach(row => {
                const skuCodes = String(row['SKUì½”ë“œ'] || '').split(',').map(s => s.trim()).filter(s => s);
                const skuNames = String(row['SKUìƒí’ˆëª…'] || '').split(',').map(s => s.trim()).filter(s => s);
                const quantities = String(row['ì´ì¶œê³ ìˆ˜ëŸ‰'] || '').split(',').map(s => s.trim()).filter(s => s);
                const wmsLocation = extractWMSLocation(row['SKUìƒí’ˆì†ì„±'] || '');
                
                const maxLength = Math.max(skuCodes.length, skuNames.length, quantities.length);
                
                for (let i = 0; i < maxLength; i++) {
                    if (skuCodes[i] && quantities[i] && quantities[i] !== '0') {
                        pickingData.push({
                            skuCode: skuCodes[i] || '',
                            skuName: skuNames[i] || skuNames[0] || '',
                            quantity: parseInt(quantities[i]) || 0,
                            wmsLocation: wmsLocation,
                            mall: row['ì‡¼í•‘ëª°'] || '',
                            recipient: row['ìˆ˜ë ¹ìëª…'] || ''
                        });
                    }
                }
            });

            // í”½í‚¹ë¦¬ìŠ¤íŠ¸ í…Œì´ë¸” ìƒì„±
            let tableHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-left">SKUì½”ë“œ</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">ìƒí’ˆëª…</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ìˆ˜ëŸ‰</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">WMSìœ„ì¹˜</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">ì‡¼í•‘ëª°</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">ìˆ˜ë ¹ì</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            pickingData.forEach(item => {
                tableHTML += `
                    <tr>
                        <td class="border border-gray-300 px-4 py-2">${item.skuCode}</td>
                        <td class="border border-gray-300 px-4 py-2">${item.skuName}</td>
                        <td class="border border-gray-300 px-4 py-2 text-center">${item.quantity}</td>
                        <td class="border border-gray-300 px-4 py-2 text-center">${item.wmsLocation}</td>
                        <td class="border border-gray-300 px-4 py-2">${item.mall}</td>
                        <td class="border border-gray-300 px-4 py-2">${item.recipient}</td>
                    </tr>
                `;
            });

            const totalQuantity = pickingData.reduce((sum, item) => sum + item.quantity, 0);
            tableHTML += `
                        <tr class="bg-yellow-50 font-bold">
                            <td class="border border-gray-300 px-4 py-2" colspan="2">í•©ê³„</td>
                            <td class="border border-gray-300 px-4 py-2 text-center">${totalQuantity}</td>
                            <td class="border border-gray-300 px-4 py-2" colspan="3"></td>
                        </tr>
                    </tbody>
                </table>
                </div>
            `;

            document.getElementById('pickingTable').innerHTML = tableHTML;
        }

        // WMS ìœ„ì¹˜ ì¶”ì¶œ
        function extractWMSLocation(attributes) {
            if (!attributes) return '';
            const match = attributes.match(/WMS:([A-Z0-9]+)/i);
            return match ? match[1] : '';
        }

        // TOP 20 SKU ë¶„ì„
        function generateTop20Analysis() {
            const skuSummary = {};
            
            processedData.forEach(row => {
                const skuCode = row['SKUì½”ë“œ'];
                const skuName = row['SKUìƒí’ˆëª…'];
                const quantity = parseInt(row['ì´ì¶œê³ ìˆ˜ëŸ‰']) || 0;
                
                if (skuCode && quantity > 0) {
                    if (!skuSummary[skuCode]) {
                        skuSummary[skuCode] = {
                            name: skuName,
                            totalQuantity: 0
                        };
                    }
                    skuSummary[skuCode].totalQuantity += quantity;
                }
            });

            const sortedSKUs = Object.entries(skuSummary)
                .sort(([,a], [,b]) => b.totalQuantity - a.totalQuantity)
                .slice(0, 20);

            // êº¾ì€ì„  ê·¸ë˜í”„ ìƒì„±
            const ctx = document.getElementById('top20Chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedSKUs.map(([code, data]) => code),
                    datasets: [{
                        label: 'ì´ ì¶œê³ ëŸ‰',
                        data: sortedSKUs.map(([code, data]) => data.totalQuantity),
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'TOP 20 SKU ì¶œê³ ëŸ‰ íŠ¸ë Œë“œ'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // í…Œì´ë¸” ìƒì„±
            let tableHTML = `
                <div class="overflow-x-auto mt-4">
                    <table class="min-w-full border border-gray-300">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-center">ìˆœìœ„</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">SKUì½”ë“œ</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">ìƒí’ˆëª…</th>
                                <th class="border border-gray-300 px-4 py-2 text-center">ì´ ì¶œê³ ëŸ‰</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sortedSKUs.forEach(([code, data], index) => {
                tableHTML += `
                    <tr>
                        <td class="border border-gray-300 px-4 py-2 text-center font-bold">${index + 1}</td>
                        <td class="border border-gray-300 px-4 py-2">${code}</td>
                        <td class="border border-gray-300 px-4 py-2">${data.name}</td>
                        <td class="border border-gray-300 px-4 py-2 text-center">${data.totalQuantity}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
                </div>
            `;

            document.getElementById('top20Table').innerHTML = tableHTML;
        }

        // ë§ˆì¼“ë³„ TOP 10 ë¶„ì„
        function generateMarketAnalysis() {
            const marketData = {};
            
            processedData.forEach(row => {
                const mall = row['ì‡¼í•‘ëª°'];
                const skuCode = row['SKUì½”ë“œ'];
                const skuName = row['SKUìƒí’ˆëª…'];
                const quantity = parseInt(row['ì´ì¶œê³ ìˆ˜ëŸ‰']) || 0;
                
                if (mall && skuCode && quantity > 0) {
                    if (!marketData[mall]) {
                        marketData[mall] = {};
                    }
                    if (!marketData[mall][skuCode]) {
                        marketData[mall][skuCode] = {
                            name: skuName,
                            totalQuantity: 0
                        };
                    }
                    marketData[mall][skuCode].totalQuantity += quantity;
                }
            });

            let chartsHTML = '';
            let tablesHTML = '';

            Object.entries(marketData).forEach(([mall, skus]) => {
                const sortedSKUs = Object.entries(skus)
                    .sort(([,a], [,b]) => b.totalQuantity - a.totalQuantity)
                    .slice(0, 10);

                const chartId = `chart_${mall.replace(/[^a-zA-Z0-9]/g, '')}`;
                
                chartsHTML += `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">${mall} TOP 10</h3>
                        <div class="chart-container">
                            <canvas id="${chartId}"></canvas>
                        </div>
                    </div>
                `;

                tablesHTML += `
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-2">${mall} TOP 10 ìƒì„¸</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full border border-gray-300">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="border border-gray-300 px-4 py-2 text-center">ìˆœìœ„</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">SKUì½”ë“œ</th>
                                        <th class="border border-gray-300 px-4 py-2 text-left">ìƒí’ˆëª…</th>
                                        <th class="border border-gray-300 px-4 py-2 text-center">ì¶œê³ ëŸ‰</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                sortedSKUs.forEach(([code, data], index) => {
                    tablesHTML += `
                        <tr>
                            <td class="border border-gray-300 px-4 py-2 text-center font-bold">${index + 1}</td>
                            <td class="border border-gray-300 px-4 py-2">${code}</td>
                            <td class="border border-gray-300 px-4 py-2">${data.name}</td>
                            <td class="border border-gray-300 px-4 py-2 text-center">${data.totalQuantity}</td>
                        </tr>
                    `;
                });

                tablesHTML += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;

                // ì°¨íŠ¸ ìƒì„±ì„ ìœ„í•´ setTimeout ì‚¬ìš©
                setTimeout(() => {
                    const ctx = document.getElementById(chartId);
                    if (ctx) {
                        new Chart(ctx.getContext('2d'), {
                            type: 'line',
                            data: {
                                labels: sortedSKUs.map(([code]) => code),
                                datasets: [{
                                    label: 'ì¶œê³ ëŸ‰',
                                    data: sortedSKUs.map(([, data]) => data.totalQuantity),
                                    borderColor: `hsl(${Math.random() * 360}, 70%, 50%)`,
                                    backgroundColor: `hsla(${Math.random() * 360}, 70%, 50%, 0.1)`,
                                    tension: 0.4,
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: `${mall} TOP 10 íŠ¸ë Œë“œ`
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                }, 100);
            });

            document.getElementById('marketCharts').innerHTML = chartsHTML;
            document.getElementById('marketTables').innerHTML = tablesHTML;
        }

        // íŒë§¤ì°¨ê°íŒŒì¼ ìƒì„±
        document.getElementById('generateSalesDeduction').addEventListener('click', function() {
            const today = new Date();
            const dateString = today.getFullYear().toString() + 
                             (today.getMonth() + 1).toString().padStart(2, '0') + 
                             today.getDate().toString().padStart(2, '0');
            
            const salesDeductionData = [];
            
            processedData.forEach(row => {
                const skuCodes = String(row['SKUì½”ë“œ'] || '').split(',').map(s => s.trim()).filter(s => s);
                const skuNames = String(row['SKUìƒí’ˆëª…'] || '').split(',').map(s => s.trim()).filter(s => s);
                const quantities = String(row['ì´ì¶œê³ ìˆ˜ëŸ‰'] || '').split(',').map(s => s.trim()).filter(s => s);
                
                const maxLength = Math.max(skuCodes.length, skuNames.length, quantities.length);
                
                for (let i = 0; i < maxLength; i++) {
                    if (skuCodes[i] && quantities[i] && quantities[i] !== '0') {
                        salesDeductionData.push({
                            'ë‚ ì§œ': dateString,
                            'ìˆœë²ˆ': '',
                            'ê±°ë˜ì²˜ì½”ë“œ': '',
                            'ê±°ë˜ì²˜ëª…': row['ì‡¼í•‘ëª°'] || '',
                            'ë‹´ë‹¹ì': '', // ì§ì ‘ì…ë ¥ í•„ìš”
                            'ì¶œí•˜ì°½ê³ ': 'ì§€í•˜ì°½ê³ (ì˜¤ë Œì§€ë‚˜ë¬´)',
                            'ê±°ë˜ìœ í˜•': '',
                            'í†µí™”': '',
                            'í™˜ìœ¨': '',
                            'í’ˆëª©ì½”ë“œ': skuCodes[i] || '',
                            'í’ˆëª©ëª…': skuNames[i] || skuNames[0] || '',
                            'ê·œê²©': '',
                            'ìˆ˜ëŸ‰': quantities[i] || '',
                            'ë‹¨ê°€': '',
                            'ì™¸í™”ê¸ˆì•¡': '',
                            'ê³µê¸‰ê°€ì•¡': '',
                            'ë¶€ê°€ì„¸': '',
                            'ì ìš”': row['ìˆ˜ë ¹ìëª…'] || '',
                            'ì‹œë¦¬ì–¼/ë¡œíŠ¸': '',
                            'ìƒì‚°ì „í‘œìƒì„±': ''
                        });
                    }
                }
            });

            // Excel íŒŒì¼ ìƒì„±
            const ws = XLSX.utils.json_to_sheet(salesDeductionData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "íŒë§¤ì°¨ê°íŒŒì¼");
            
            const fileName = `íŒë§¤ì°¨ê°íŒŒì¼_${dateString}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            alert(`íŒë§¤ì°¨ê°íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: ${fileName}`);
        });

        // ì¸ì‡„ ê¸°ëŠ¥
        document.getElementById('printPicking').addEventListener('click', function() {
            window.print();
        });
    </script>
<!-- Notion-like Block: ECOUNT ì¬ê³ ì‹¤ì‚¬ìš© ê°€ì´ë“œ (paste near </body>) -->
<style>
  .notion-ecount { max-width: 920px; margin: 40px auto 64px; padding: 0 16px;
    font-family: Pretendard, "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    color: #0f172a; line-height: 1.75; }
  .notion-ecount h1 { font-size: 1.5rem; margin: 0 0 10px; display: flex; gap: 8px; align-items: center; }
  .notion-ecount h2 { font-size: 1.125rem; margin: 22px 0 10px; }
  .notion-ecount a { color: #2563eb; text-decoration: none; border-bottom: 1px solid rgba(37,99,235,.35); }
  .notion-ecount .callout { background: #f8fafc; border: 1px solid #e5e7eb; border-radius: 12px;
    padding: 12px 14px; display: flex; gap: 10px; align-items: flex-start; margin: 12px 0 18px; }
  .notion-ecount .callout-emoji { font-size: 1.1rem; }
  .notion-ecount .chip { display:inline-block; padding: 2px 8px; border-radius: 999px; background: #eef2ff; color:#3730a3; font-weight:600; font-size:.8rem; }
  .notion-ecount kbd { background:#111827; color:#fff; border-radius:6px; padding:2px 6px; font-size:.8rem; }
  .notion-ecount ol { padding-left: 1.25rem; }
  .notion-ecount ol > li { margin: 8px 0; }
  .notion-ecount .steps { counter-reset: step; list-style: none; padding-left: 0; }
  .notion-ecount .steps li { display:flex; gap:12px; align-items:flex-start; margin: 10px 0; }
  .notion-ecount .steps li::before {
    counter-increment: step; content: counter(step);
    flex:0 0 28px; height:28px; display:grid; place-items:center;
    background:#111827; color:#fff; border-radius:50%;
    font-weight:700; font-size:.9rem; margin-top: 2px;
  }
  .notion-ecount details { background: #fafafa; border: 1px solid #eee; border-radius: 12px;
    padding: 12px; margin: 12px 0; }
  .notion-ecount summary { cursor: pointer; font-weight: 700; }
  .notion-ecount .tip, .notion-ecount .warn {
    border-radius: 12px; padding: 10px 12px; margin: 12px 0;
    border:1px solid;
  }
  .notion-ecount .tip { background:#f0fdf4; border-color:#86efac; }
  .notion-ecount .warn { background:#fff7ed; border-color:#fdba74; }
  .notion-ecount code { background:#f3f4f6; border:1px solid #e5e7eb; padding:2px 6px; border-radius:6px; }
  .notion-ecount .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  .notion-ecount hr { border: 0; border-top: 1px solid #e5e7eb; margin: 18px 0; }
</style>

<div class="notion-ecount" id="ecount-physical-inventory">
  <h1>ğŸ“¦ ì¬ê³ ì‹¤ì‚¬ìš© ECOUNT ERP ìë£Œ ë‹¤ìš´ë¡œë“œ ì ˆì°¨</h1>

  <div class="callout">
    <div class="callout-emoji">âš™ï¸</div>
    <div>
      <strong>ì‚¬ì „ ì•ˆë‚´</strong><br>
      ì´ ì ˆì°¨ëŠ” <span class="chip">My Page ì„¤ì • ì™„ë£Œ</span> í›„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì•„ë˜ <em>ì„¤ì • ë°©ë²•</em>ì„ ë¨¼ì € ìˆ˜í–‰í•˜ì„¸ìš”.
    </div>
  </div>

  <details>
    <summary>ğŸ”§ My Page ì„¤ì • ë°©ë²• (ì„ í–‰)</summary>
    <div style="margin-top:8px">
      <ol>
        <li>ë¡œê·¸ì¸ í™”ë©´ ìš°ì¸¡ ìƒë‹¨ <kbd>í”„ë¡œí•„</kbd> í´ë¦­ â†’ <kbd>ê°œì¸ê¸°ëŠ¥ì„¤ì •</kbd> ì§„ì…</li>
        <li><kbd>mypageì„¤ì •</kbd> í´ë¦­</li>
        <li>ì™¼ìª½ <strong>mypage ê¸°ë³¸ê·¸ë£¹</strong>ì—ì„œ ë¹ ë¥¸ ì ‘ì† ë©”ë‰´ ì„ íƒ
          <div class="tip" style="margin-top:8px">
            <strong>ì²´í¬ ê²½ë¡œ</strong>:
            <span class="mono">ì¬ê³ 1 â†’ ì¶œë ¥ë¬¼ â†’ ì¬ê³ í˜„í™© â†’ ì¬ê³ ë³€ë™í‘œ</span> ì„ íƒ í›„
            <kbd>â†</kbd> ë²„íŠ¼ìœ¼ë¡œ ê¸°ë³¸ê·¸ë£¹ì— ì´ë™
          </div>
        </li>
        <li><strong>ì¬ê³ ë³€ë™í‘œ</strong> í™”ë©´ì—ì„œ ìš°ì¸¡ <kbd>+</kbd>ë¡œ ìƒˆ íƒ­ ìƒì„± â†’ íƒ­ ì´ë¦„ì„ <code>ë‹¹ì¼ì¬ê³ ì‹¤ì‚¬ìš©</code>ìœ¼ë¡œ ë³€ê²½</li>
        <li><strong>ì°½ê³ ì§€ì •</strong>ì„ <code>ì§€í•˜ì°½ê³ (ì˜¤ë Œì§€ë‚˜ë¬´)</code>ë¡œ ì„¤ì • â†’ <kbd>ì €ì¥</kbd>/<kbd>ê²€ìƒ‰</kbd></li>
        <li>í™”ë©´ í•˜ë‹¨ <span class="mono">ê²€ìƒ‰ | ê¸ˆì¼ | ì „ì¼ ...</span> ì˜ì—­ì—ì„œ ìš°ì¸¡ ì•„ë˜ <strong>êº¾ì‡ </strong> ì•„ì´ì½˜ìœ¼ë¡œ í™•ì¥ â†’
          <kbd>ì„¤ì •</kbd> â†’ <strong>ê°„í¸ê²€ìƒ‰ëª…</strong> <code>ê¸ˆì¼</code> ìš°ì¸¡ <strong>ì¡°íšŒê¸°ë³¸ê°’</strong> ì²´í¬ â†’ <kbd>ì €ì¥</kbd>
        </li>
      </ol>
    </div>
  </details>

  <h2>ğŸš€ ì‹¤í–‰ ìˆœì„œ</h2>
  <ol class="steps">
    <li>ğŸ”— <strong>ì ‘ì†</strong> â€” <a href="https://login.ecount.com/Login/" target="_blank" rel="noopener">https://login.ecount.com/Login/</a></li>
    <li>ğŸ‘¤ <strong>ë¡œê·¸ì¸</strong> â€” íšŒì‚¬ì½”ë“œ / ì•„ì´ë”” / ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</li>
    <li>ğŸ§­ <strong>ì´ë™</strong> â€” <kbd>My Page</kbd> í•˜ìœ„ ë©”ë‰´ì˜ <kbd>ì¬ê³ ë³€ë™í‘œ</kbd> í´ë¦­</li>
    <li>ğŸ·ï¸ <strong>ì¡°ê±´ í™•ì¸</strong> â€” ì°½ê³ : <code>ì§€í•˜ì°½ê³ (ì˜¤ë Œì§€ë‚˜ë¬´)</code>, ê¸°ì¤€ì¼ì: <code>ì˜¤ëŠ˜ ~ ì˜¤ëŠ˜</code> ìƒíƒœ í™•ì¸ í›„ <kbd>ê²€ìƒ‰</kbd></li>
    <li>ğŸ“¤ <strong>ë‹¤ìš´ë¡œë“œ</strong> â€” ì¡°íšŒ ê²°ê³¼ í•˜ë‹¨ì˜ <kbd>Excel</kbd> ë²„íŠ¼ í´ë¦­ â†’ íŒŒì¼ ì €ì¥<br>
        í‘œì¤€ íŒŒì¼ëª…: <code>ì¬ê³ ì‹¤ì‚¬í‘œ_YYYYMMDD_HHMM.xls</code></li>
    <li>ğŸ§½ <strong>ë°ì´í„° ì •ë¦¬</strong> â€” ì—‘ì…€ì„ ì—´ì–´ <strong>Eì—´(ì¶œê³ ìˆ˜ëŸ‰)</strong>ì´ <u>ì—†ëŠ” í–‰</u>ì„ í•˜ë‹¨ìœ¼ë¡œ ëª¨ì•„ <u>í–‰ ì‚­ì œ</u></li>
    <li>âœ… <strong>ì‹¤ì‚¬ ëŒ€ìƒ í™•ì •</strong> â€” ë‚¨ì•„ìˆëŠ” í–‰ì˜ <code>SKU</code>ê°€ <strong>ë‹¹ì¼ ì¬ê³ ì‹¤ì‚¬ ëŒ€ìƒ</strong></li>
    <li>ğŸ“ <strong>í˜„ì¥ ì‹¤ì‚¬</strong> â€” ë‹¨í’ˆ ìœ„ì¹˜/ì¹´í†¤ ë°•ìŠ¤ ìœ„ì¹˜ í™•ì¸ í›„ ì‹¤ì‚¬ ì§„í–‰</li>
  </ol>

  <div class="warn">
    âš ï¸ <strong>ì£¼ì˜</strong><br>
    í–‰ ì‚­ì œ ì „ íŒŒì¼ì„ <em>ë³„ë„ ì‚¬ë³¸</em>(ì˜ˆ: <code>ì¬ê³ ì‹¤ì‚¬í‘œ_RAW_YYYYMMDD_HHMM.xls</code>)ìœ¼ë¡œ ë³´ê´€í•˜ì„¸ìš”.
  </div>

  <hr>
  <h2>ğŸ—‚ï¸ íŒŒì¼ëª… ê·œì¹™</h2>
  <p><code>ì¬ê³ ì‹¤ì‚¬í‘œ_YYYYMMDD_HHMM.xls</code> (ì˜ˆ: <code>ì¬ê³ ì‹¤ì‚¬í‘œ_20250825_1030.xls</code>)</p>

  <div class="tip">
    ğŸ’¡ <strong>íŒ</strong><br>
    í¬ë¡¬ì„ ì‚¬ìš©í•  ê²½ìš°, íŒì—… ì°¨ë‹¨ í•´ì œí•˜ë©´ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜ê°€ ì¤„ì–´ë“­ë‹ˆë‹¤. ê¸°ê°„ ì¡°ê±´ì„ ë¨¼ì € ë§ì¶˜ ë’¤ ì¡°íšŒí•˜ë©´ ì†ë„ê°€ ë¹¨ë¼ì§‘ë‹ˆë‹¤.
  </div>
</div>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDsQ%2FYgpJ6LyFZ9Gx5YBhgHrtqknd6E25m6xa7X3XG6HSWQIRG7hDORakE9RshA%2FVXhjkgtevR7Y8%2BnY3mhW7tw8jbktA1O42BiyeQ6Q2R0Fz0GLg46jg6XV%2BrcQrJ%2FjmrrPWWhLAzowDgwNsrze4WBuqtTLXXv3gaN%2FoIynrG7%2BcA9UM0Eb2JEs%2BVFBl7VGIxI1wyze6nnaIZl8UyueIPH1aslkKftQytilgDV6qAulgkUcTa1%2F018mUoYoMWsSD%2FsjKZCBjfeQVLKTJSDmbaUvmCzsU06GnxXVIyU0iWNYt694S2TPqA2lYAVX1TqTgMwz03HKqsXOHzK9AH9%2BQytdlcHnf2iPUvA7Uc39hrDk8X2A%2FC16fNU%2FmgMJCP92wNwcq6k%2F2KvSkcT5frDXWLRx0lY4lMtWDXTsjfwJ1w8v2XvwyTpQt76fN26I%2BagO6b37jOEGCDQzAm0hPCEmfVfgnQdlBlkTlrG1CoMqC85y1SOqlmaJXiGaS4Qfrx4kOK1BSrkYWquvfz6QVRKHE3rA%3D";
        window.__genspark_locale = "ko-KR";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDsQ/YgpJ6LyFZ9Gx5YBhgHrtqknd6E25m6xa7X3XG6HSWQIRG7hDORakE9RshA/VXhjkgtevR7Y8+nY3mhW7tw8jbktA1O42BiyeQ6Q2R0Fz0GLg46jg6XV+rcQrJ/jmrrPWWhLAzowDgwNsrze4WBuqtTLXXv3gaN/oIynrG7+cA9UM0Eb2JEs+VFBl7VGIxI1wyze6nnaIZl8UyueIPH1aslkKftQytilgDV6qAulgkUcTa1/018mUoYoMWsSD/sjKZCBjfeQVLKTJSDmbaUvmCzsU06GnxXVIyU0iWNYt694S2TPqA2lYAVX1TqTgMwz03HKqsXOHzK9AH9+QytdlcHnf2iPUvA7Uc39hrDk8X2A/C16fNU/mgMJCP92wNwcq6k/2KvSkcT5frDXWLRx0lY4lMtWDXTsjfwJ1w8v2XvwyTpQt76fN26I+agO6b37jOEGCDQzAm0hPCEmfVfgnQdlBlkTlrG1CoMqC85y1SOqlmaJXiGaS4Qfrx4kOK1BSrkYWquvfz6QVRKHE3rA=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    